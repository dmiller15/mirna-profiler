#!/usr/bin/env cwl-runner

description: |
  Perl wrapper that calls R to generate graphs of feature representations, filtered results and quality metrics based on files generated by alignment_stats.pl. The script generates graphs for each sample under the project directory.

  Usage: cwl-runner <this-file-path> -s <sam_path> -f <filtered_taglen_path> -o <softclip_taglen_path> -a <adapter_taglen_path> -h <chastity_taglen_path> -t <alignment_stats_path>
  Required Options:
    -s:	   Path to sam file
    -f:	   Path to filtered taglength csv
    -o:	   Path to softclip taglength csv
    -a:	   Path to adapter report
    -h:	   Path to chastity taglength csv
    -t:	   Path to alignment stats csv

requirements:
  - class: DockerRequirements
    dockerPull: quay.io/dmiller15/mir_profiler

inputs:
  - id: "#sam_path"
    type: File
    inputBinding:
      prefix: -s

  - id: "#filtered_taglen"
    type: File
    inputBinding:
      prefix: -f

  - id: "#softclip_taglen"
    type: File
    inputBinding:
      prefix: -o

  - id: "#adapter_taglen"
    type: File
    inputBinding:
      prefix: -a

  - id: "#chastity_taglen"
    type: File
    inputBinding:
      prefix: -h

  - id: "alignment_stats"
    type: File
    inputBinding:
      prefix: -t

outputs:
  - id: "#tags_graph"
    type: File
    outputBinding:
      glob: *_tags.jpg

  - id: "#softclip_graph"
    type: File
    outputBinding:
      glob: *_softclip.jpg

  - id: "#adapter_graph"
    type: File
    outputBinding:
      glob: *_NA.jpg

  - id: "#chastity_graph"
    type: File
    outputBinding:
      glob: *_chastity.jpg

  - id: "saturation_graph"
    type: File
    outputBinding:
      glob: *_saturation.jpg

baseCommand: ["python", "/home/ubuntu/bin/mirna-profiler/py-tools/mir_graph.py"]
