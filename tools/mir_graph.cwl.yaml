#!/usr/bin/env cwl-runner

description: |
  Perl wrapper that calls R to generate graphs of feature representations,
  filtered results and quality metrics based on files generated by
  alignment_stats.pl. The script generates graphs for each sample under the
  project directory.

  Usage: cwl-runner <this-file-path> XXXX
  Options:
    --sam_path		XXXX
    --filtered_taglen 	XXXX
    --softclip_taglen 	XXXX
    --adapter_taglen 	XXXX
    --chastity_taglen	XXXX
    --alignment_stats 	XXXX 
    --connect_path 	XXXX

requirements:
  - class: DockerRequirement
    dockerPull: quay.io/dmiller15/mir-profiler

class: CommandLineTool

inputs:
  - id: "#sam_path"
    type: File
    inputBinding:
      prefix: -s

  - id: "#filtered_taglen"
    type: File
    inputBinding:
      prefix: -f

  - id: "#softclip_taglen"
    type: File
    inputBinding:
      prefix: -v

  - id: "#adapter_report"
    type: File
    inputBinding:
      prefix: -a

  - id: "#chastity_taglen"
    type: File
    inputBinding:
      prefix: -c

  - id: "#alignment_stats"
    type: File
    inputBinding:
      prefix: -l

  - id: "#uuid"
    type: string
    inputBinding:
      prefix: -u

  - id: "#barcode"
    type: string
    inputBinding:
      prefix: -r

  - id: "#db_cred_s3url"
    type: string
    inputBinding:
      prefix: -y

  - id: "#s3cfg_path"
    type: File
    inputBinding:
      prefix: -z

outputs:
  - id: "#tags_graph"
    type: File
    outputBinding:
      glob: ./*_tags.jpg

  - id: "#softclip_graph"
    type: File
    outputBinding:
      glob: ./*_softclip.jpg

  - id: "#adapter_graph"
    type: File
    outputBinding:
      glob: ./*_NA.jpg

  - id: "#chastity_graph"
    type: File
    outputBinding:
      glob: ./*_chastity.jpg

  - id: "#saturation_graph"
    type: File
    outputBinding:
      glob: ./*_saturation.jpg

  - id: "#graph_log"
    type: File
    outputBinding:
      glob: ./*.log

baseCommand: ["python", "/home/ubuntu/bin/mirna-profiler/py-tools/mir_graph.py"]
