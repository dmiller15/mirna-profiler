#!/usr/bin/env cwl-runner

description: |
  Perl wrapper that calls R to generate graphs of feature representations, filtered results and quality metrics based on files generated by alignment_stats.pl. The script generates graphs for each sample under the project directory.

  Usage: cwl-runner <this-file-path> --sam_path <sam_path> --filtered_taglen <filtered_taglen_path> 
         --softclip_taglen <softclip_taglen_path> --adapter_taglen <adapter_taglen_path> 
         --chastity_taglen <chastity_taglen_path> --alignment_stats <alignment_stats_path> 
         --connect_path <connect_path>

requirements:
  - class: DockerRequirements
    dockerPull: quay.io/dmiller15/mir-profiler

inputs:
  - id: "#sam_path"
    type: File
    inputBinding:
      prefix: -s

  - id: "#filtered_taglen"
    type: File
    inputBinding:
      prefix: -f

  - id: "#softclip_taglen"
    type: File
    inputBinding:
      prefix: -o

  - id: "#adapter_taglen"
    type: File
    inputBinding:
      prefix: -a

  - id: "#chastity_taglen"
    type: File
    inputBinding:
      prefix: -h

  - id: "#alignment_stats"
    type: File
    inputBinding:
      prefix: -t

  - id: "#connect_path"
    type: File
    inputBinding:
      prefix: -x

outputs:
  - id: "#tags_graph"
    type: File
    outputBinding:
      glob: *_tags.jpg

  - id: "#softclip_graph"
    type: File
    outputBinding:
      glob: *_softclip.jpg

  - id: "#adapter_graph"
    type: File
    outputBinding:
      glob: *_NA.jpg

  - id: "#chastity_graph"
    type: File
    outputBinding:
      glob: *_chastity.jpg

  - id: "saturation_graph"
    type: File
    outputBinding:
      glob: *_saturation.jpg

baseCommand: ["python3", "/home/ubuntu/bin/mirna-profiler/py-tools/mir_graph.py"]
