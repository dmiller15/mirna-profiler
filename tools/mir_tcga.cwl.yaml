#!/usr/bin/env cwl-runner

description: |
  The tcga.pl script resolves crossmapped and multimapped reads then formats resulting 
  expression files to the format defined for TCGA. Can be run on a desktop computer. 
  Needs miRBase access.

  Usage: >
    cwl-runner <this-file-path> --mirna_db <mirna_db> --species_code <species_code> 
    --ucsc_db <ucsc_db> --sam_path <sam_path> --mirna_species <mirna_species_path> 
    --crossmapped <crossmapped_path> --isoforms <isoforms_path> --connect_path <connect_path>

requirements:
  - class: DockerRequirement
    dockerPull: quay.io/dmiller15/mir-profiler

class: CommandLineTool

inputs:
  - id: "#db_connect"
    type: string
    inputBinding:
      prefix: -c
      
  - id: "#genome_version"
    type: string
    inputBinding:
      prefix: -g

  - id: "#species_code"
    type: string
    inputBinding:
      prefix: -o

  - id: "#sam_path"
    type: File
    inputBinding:
      prefix: -s

  - id: "#mirna_species"
    type: File
    inputBinding:
      prefix: -r

  - id: "#crossmapped"
    type: File
    inputBinding:
      prefix: -x

  - id: "#isoforms"
    type: File
    inputBinding:
      prefix: -i

outputs:
  - id: "#isoform_quant"
    type: File
    description: "TCGA quantification of the isoform data"
    outputBinding:
      glob: ./tcga/isoforms*

  - id: "#mirna_quant"
    type: File
    description: "TCGA quantification of the mirna data"
    outputBinding:
      glob: ./tcga/mirnas*

baseCommand: ["python3", "/home/ubuntu/bin/mirna-profiler/py-tools/mir_tcga.py"]
