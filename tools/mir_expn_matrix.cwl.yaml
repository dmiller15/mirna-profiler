#!/usr/bin/env cwl-runner

description: |
  Generates an miRNA expression matrix with pre-miRNA genes as rows and gets read counts from the mirna_species.txt files.

  Usage: cwl-runner <this-file-path> --mirna_db <mirna_db> --species_code <species_code> --sam_path <sam_path> 
         --mirna_path <mirna_path> --connect_path <connect_path>

requirements:
  - import: node-engine.cwl
  - import: envvar-global.cwl
  - class: DockerRequirement
    dockerPull: quay.io/dmiller15/mir_profiler

inputs:
  - id: "#mirna_db"
    type: string
    inputBinding:
      prefix: -m
      
  - id: "#species_code"
    type: string
    inputBinding:
      prefix: -o
      
  - id: "#sam_path"
    type: file
    inputBinding:
      prefix: -s

  - id: "#mirna_path"
    type: file
    inputBinding:
      prefix: -r

  - id: "#connect_path"
    type: file
    inputBinding:
      prefix: -x

outputs:
  - id: "#matrix"
    type: file
    description: "matrix file"
    outputBinding:
      glob:
        engine: node-engine.cwl
        script: |
        {
        return $job + "expn_matrix.txt"
        }

  - id: "#matrix_norm"
    type: file
    description: "matrix norm"
    outputBinding:
      glob:
        engine: node-engine.cwl
        script: |
        {
        return $job + "expn_matrix_norm.txt"
        }

  - id: "#matrix_norm_log"
    type: file
    descripiton: "matrix norm log"
    outputBinding:
      glob:
        engine: node-engine.cwl
        script: |
        {
        return $job + "expn_matrix_norm_log.txt"
        }

baseCommand: ["python3", "home/ubuntu/bin/mirna-profiler/py-tools/mir_expn_matrix.py"]
