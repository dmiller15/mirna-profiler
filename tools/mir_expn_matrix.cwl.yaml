#!/usr/bin/env cwl-runner

description: |
  Generates an miRNA expression matrix with pre-miRNA genes as rows and gets read counts from the mirna_species.txt files.

  Usage: cwl-runner <this-file-path> --mirna_db <mirna_db> --species_code <species_code> --sam_path <sam_path> 
         --mirna_path <mirna_path> --connect_path <connect_path>

requirements:
  - class: DockerRequirement
    dockerPull: quay.io/dmiller15/mir-profiler

class: CommandLineTool

inputs:
  - id: "#db_connect"
    type: string
    inputBinding:
      prefix: -d
      
  - id: "#species_code"
    type: string
    inputBinding:
      prefix: -o
      
  - id: "#sam_path"
    type: File 
    inputBinding:
      prefix: -s

  - id: "#mirna_species"
    type: File
    inputBinding:
      prefix: -r

outputs:
  - id: "#matrix"
    type: File
    description: "matrix file"
    outputBinding:
      glob: ./expn_matrix.txt

  - id: "#matrix_norm"
    type: File
    description: "matrix norm"
    outputBinding:
      glob: ./expn_matrix_norm.txt

  - id: "#matrix_norm_log"
    type: File
    description: "matrix norm log"
    outputBinding:
      glob: ./expn_matrix_norm_log.txt

baseCommand: ["python3", "/home/ubuntu/bin/mirna-profiler/py-tools/mir_expn_matrix.py"]
